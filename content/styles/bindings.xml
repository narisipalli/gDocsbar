<?xml version="1.0"?>
<!DOCTYPE window [
]>

<bindings xmlns="http://www.mozilla.org/xbl"
    xmlns:xbl="http://www.mozilla.org/xbl"
    xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
	xmlns:html="http://www.w3.org/1999/xhtml">

<binding id="treeEditable" extends="chrome://global/content/bindings/tree.xml#tree">
	<content>
	      <children/>
	      <xul:treerows class="tree-container-treerows" xbl:inherits="dragover,dragdroptree">
	        <children includes="treehead|treechildren"/>
	      </xul:treerows>
	</content>
</binding>
<binding id="gdfoldertreeitem" extends="chrome://global/content/bindings/tree.xml#tree-base">
  <content>
  	<children />
  </content>
  <implementation>
    <method name="toggleOpenState">
      <body>
        <![CDATA[
          if ((this.getAttribute('container') == 'true') &&
               (this.getAttribute('empty') != 'true')) {
             if (this.getAttribute('open') == 'true')
               this.removeAttribute('open');
             else this.setAttribute('open', 'true');
          }
        ]]>
      </body>
    </method>
   <method name="open">
     <body>
        <![CDATA[
          if ((this.getAttribute('container') == 'true') &&
               (this.getAttribute('empty') != 'true')) {
             if (this.getAttribute('open') != 'true')
               this.setAttribute('open', 'true');
          }
        ]]>
      </body>
   </method>
   <method name="close">
     <body>
        <![CDATA[
          if ((this.getAttribute('container') == 'true') &&
               (this.getAttribute('empty') != 'true')) {
             if (this.getAttribute('open') == 'true')
               this.removeAttribute('open');
          }
        ]]>
      </body>
   </method>
 </implementation>
</binding>


<binding id="document" extends="xul:vbox">
	<content>
		<xul:hbox style="overflow-x:hidden;" mode="displayandedit">
			<xul:description xbl:inherits="xbl:text=name" class="name"/>
		</xul:hbox>
		<html:div mode="display" class="folders" anonid="folders" collapsed="true">
		</html:div>
		<xul:vbox flex="1" style="padding-left:25px;" mode="display">
			<xul:label crop="end" xbl:inherits="value=author, tooltiptext=author" class="date" style="margin-left:0;"/>
			<xul:hbox align="center" style="margin-top:5px;" mode="display" flex="1">
				<xul:gicon xbl:inherits="class=star" onclick="star();"/><xul:label xbl:inherits="value=datetime" class="date" /><xul:spacer flex="1" /><xul:gicon class="options" popup="gdocumentmenu" tooltiptext="Actions"/><xul:gicon class="more" tooltiptext="More information"/>
			</xul:hbox>
		</xul:vbox>
		<xul:vbox mode="edit" style="margin-left:0px;">
			<xul:textbox xbl:inherits="value=name" anonid="name_textbox"/>
			<xul:hbox align="center">
				<xul:button label="save" oncommand="saveName();"/><xul:label class="text-link" value="cancel" onclick="cancelRename();" />
			</xul:hbox>
		</xul:vbox>
	</content>
	<implementation>
		<constructor>
			<![CDATA[
				
			]]>
		</constructor>
		<method name="rename">
			<body>
				<![CDATA[
					gbar.addClass(this, "edit");
					name = document.getAnonymousElementByAttribute(this, "anonid", "name_textbox");
					name.select();
					name.focus();
				]]>
			</body>
		</method>
		<method name="cancelRename">
			<body>
				<![CDATA[
					gbar.removeClass(this, "edit");
				]]>
			</body>
		</method>
		<method name="saveName">
			<body>
				<![CDATA[
          			gbar.addClass(this, "loading");
					this.newTitle = document.getAnonymousElementByAttribute(this, "anonid", "name_textbox").value;
          			gdListAPI.rename(this,document.getAnonymousElementByAttribute(this, "anonid", "name_textbox").value);
				]]>
			</body>
		</method>
		<method name="nameSavedError">
			<body>
				<![CDATA[
				gbar.removeClass(this, "loading");
				]]>
			</body>
		</method>
		<method name="nameSaved">
			<parameter name="data" />
			<body>
				<![CDATA[
					if(data){
						gbar.removeClass(this, "edit");
						gbar.removeClass(this, "loading");
						debug(data);
						entry = new gdEntry(data.entry);
						newel = gbar.makegdocument(entry);
						this.parentNode.replaceChild(newel, this);
					}
				]]>
			</body>
		</method>
		<method name="deleted">
			<parameter name="data" />
			<body>
				<![CDATA[
						gbar.removeClass(this, "loading");
						gbar.addClass(this, "deleted");
				]]>
			</body>
		</method>
		<method name="star">
			<body>
				<![CDATA[
					gbar.addClass(this, "loading");
					switch(this.getAttribute('star')){
						case "star":
						gdListAPI.unstar(this);
						break;
						
						case "nostar":
						gdListAPI.star(this);
						break;
					}
				]]>
			</body>
		</method>
		<method name="delete">
			<body>
				<![CDATA[
					gbar.addClass(this, "loading");
          			gdListAPI.delete(this);
				]]>
			</body>
		</method>
		<method name="hide">
			<body>
				<![CDATA[
					gbar.addClass(this, "loading");
          			gdListAPI.hide(this);
				]]>
			</body>
		</method>
		<method name="download">
			<parameter name="format" />
			<body>
				<![CDATA[
          gdListAPI.download(this,format);
				]]>
			</body>
		</method>
		<method name="preview">
			<body>
        <![CDATA[
          gdBrowser.preview(this);
				]]>
			</body>
		</method>
	</implementation>
</binding>	

<binding id="gicon" extends="xul:label"/>

<binding id="gfolder" extends="xul:hbox">
	<content>
		<xul:gicon class="folder" /><xul:label xbl:inherits="value=title" />
	</content>
</binding>


<binding id="moreloader">
	<content>
		<xul:stack anonid="stack">
			<xul:label xbl:inherits="value=label" style="padding:1px 1px 0 0; color:#FFF;" />
			<xul:label xbl:inherits="value=label" style="color:#666;"/>
		</xul:stack>
		<xul:stack anonid="loading">
			<xul:label value="loading..." style="padding:1px 1px 0 0; color:#FFF;" />
			<xul:label value="loading..." style="color:#666;"/>
		</xul:stack>
	</content>
</binding>


<binding id="gdlistholder" extends="xul:vbox">
	<content>
		<xul:hbox style="background-color:#EFEFEF;font-size:7pt;" class="listdetail"><xul:hbox class="nonemptytext"><xul:label value="1"/><xul:label value="-" /><xul:label xbl:inherits="value=numshowing" /><xul:label value="of" /><xul:label xbl:inherits="value=total" /></xul:hbox><xul:label value="0 Files found" class="emptytext"></xul:label><xul:spacer flex="1" /><xul:gicon class="refresh" onclick="gbar.refreshDocumentFeed();" /></xul:hbox>
		<xul:vbox flex="1" style="overflow:auto;">
			<xul:vbox anonid="childrenholder">
				<children />
			</xul:vbox>
			<xul:moreloader xbl:inherits="step, startindex, total, class" anonid="moreloader" onclick="gbar.getMoreDocuments();"/>
		</xul:vbox>
		
	</content>
	<implementation>
		<method name="clearContents">
			<body>
				<![CDATA[
					childrenholder = document.getAnonymousElementByAttribute(this, "anonid", "childrenholder");
					while(this.childNodes.length > 0){
						this.removeChild(this.firstChild);
					}
					this.moreloader.setAttribute('collapsed', false);
					this.moreloader.setAttribute("label", "");
				]]>
			</body>
		</method>
		<constructor>
			<![CDATA[
				this.moreloader = document.getAnonymousElementByAttribute(this, "anonid", "moreloader");
			]]>
		</constructor>
		<property name="startindex">
			<setter>
				<![CDATA[
					
					this.si = parseInt(val);
					
					this.step = parseInt(this.getAttribute("step"));
					this.total = parseInt(this.getAttribute("total"));
					this.si = parseInt(this.getAttribute("startindex"));

						debug((this.total - (this.si + this.step - 1) ) +"<="+ this.step);
						if(isNaN(this.total)){
							this.moreloader.setAttribute('collapsed', true);
						}
						else if(this.step >= this.total){
							this.setAttribute("numshowing", this.total)	;
							this.moreloader.setAttribute('collapsed', true);
						}
						else if(this.si == this.total){
							this.setAttribute("numshowing", this.total)	;
							this.moreloader.setAttribute('collapsed', true);
						}
						else if(this.total - (this.si + this.step - 1) <= 0){
							this.setAttribute("numshowing", this.total)	;
							this.moreloader.setAttribute('collapsed', true);
							
						}
						else if(this.total - (this.si + this.step - 1) <= this.step){
							this.moreloader.setAttribute("label", "load last "+(this.total - (this.si + this.step - 1))+".");
							this.setAttribute("numshowing", (this.si + this.step - 1))	;
							this.moreloader.setAttribute('collapsed', false);
						}
						else{
							this.moreloader.setAttribute("label", "load "+this.step+" more...");
							this.setAttribute("numshowing", this.si + this.step -1);
							this.moreloader.setAttribute('collapsed', false);
						}
						
					debug("setter");
				]]>
			</setter>
		</property>
	</implementation>
</binding>

<binding id="gdsearch">
	<content>
		<xul:vbox flex="1">
			<xul:hbox flex="1">
				<xul:textbox flex="1" anonid="query" emptytext="Search documents" type="search" oncommand="gbar.getFullDocList();" searchbutton="true"/><xul:gicon class="search"  onclick="gbar.getFullDocList();"/>
			</xul:hbox>
			<xul:hbox pack="center">
				<xul:checkbox label="Title" anonid="title"  oncommand="titleoptions(this);"/>
				<xul:radiogroup orient="horizontal" anonid="title-exact" collapsed="true">
				  <xul:radio label="Exact" value="true"/>
				  <xul:radio label="Like"  value="false" selected="true"/>
				</xul:radiogroup>
			</xul:hbox>
		</xul:vbox>
	</content>
	<implementation>
		<method name="getQueryParams">
			<body>
				<![CDATA[
					var b = {};
					b.queryText = document.getAnonymousElementByAttribute(this, "anonid", "query").value;
					b.title = document.getAnonymousElementByAttribute(this, "anonid", "title").hasAttribute("checked");
					b["title-exact"] = document.getAnonymousElementByAttribute(this, "anonid", "title-exact").value;
					return b;
				]]>
			</body>
		</method>
		<method name="titleoptions">
			<parameter name="obj" />
			<body>
				<![CDATA[
					titleexact = document.getAnonymousElementByAttribute(this, "anonid", "title-exact");
					if(obj.hasAttribute("checked")){
						titleexact.setAttribute('collapsed', false);
					}
					else{
						titleexact.setAttribute('collapsed', true);
					}
				]]>
			</body>
		</method>
	</implementation>
</binding>


</bindings>
